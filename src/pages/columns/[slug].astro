---
import BaseLayout from '../../layouts/BaseLayout.astro';
import siteData from '../../../siteData.mjs';
import Button from '../../components/Button';
import ContactCTA from '../../components/ContactCTA.astro';
import { getCollection, getEntryBySlug } from 'astro:content';
import { Image } from 'astro:assets';

// 全 slug を静的生成
export async function getStaticPaths() {
    const allColumns = await getCollection('columns');
    return allColumns.map((entry) => ({ params: { slug: entry.slug } }));
}

// slug から記事取得
const { slug } = Astro.params;
const entry = await getEntryBySlug('columns', slug);
//もし見つからなかったらコメントを返す
if (!entry) {
    throw new Error(`記事が見つかりませんでした: ${slug}`);
}

// render() して Content を取り出す
const { Content, headings } = await entry.render();
// data は entry.data から取る
const { data } = entry;

// 日付を文字列に統一
const dateText = typeof data.date === 'string' ? data.date : data.date.toISOString().slice(0, 10);

const imageData = data.image;
---

<BaseLayout title={data.title}>
    <article class="columns-article l-wrapper pt-10 sm:pt-4" data-aos="fade-left" data-aos-delay="200">
        <div class="l-container columns-detail mb-10">
            <div class="l-inner">
                <nav class="breadcrumb flex justify-end my-3 sm:mt-6" aria-label="パンくずリスト">
                    <ol>
                        <li><a href={siteData.columns.path}>columns</a></li>
                        <li><span aria-current="page">{data.title}</span></li>
                    </ol>
                </nav>

                <h1 class="font-bold mt-4 mb-2 heading-gradient">{data.title}</h1>
                <p class="font-bold mb-6">{dateText} ／ {data.category}</p>

                {
                    data.image && (
                        <figure class="mb-6 img-wrapper rounded-lg">
                            <Image src={data.image} alt={data.title} loading="lazy" />
                        </figure>
                    )
                }

                <div>
                    <Content />
                </div>

                <div class="flex justify-end">
                    <Button href={siteData.works.path} className="works__btn" variant="push">
                        <span>その他の制作物はこちら</span>
                    </Button>
                </div>
            </div>
        </div>

        <ContactCTA
            titleLine1="ご相談だけでもOK"
            titleLine2="ちょっとしたことでもお気軽にどうぞ"
            buttonText="ご質問はこちら"
            backgroundImage="/assets/image/columns_contact_cta_bg.jpg"
        />
    </article>
</BaseLayout>
